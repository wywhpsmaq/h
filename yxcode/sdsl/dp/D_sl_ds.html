<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Davidçš„æ‰«é›·æ¸¸æˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: white;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .password-container {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            text-align: center;
        }
        
        .password-input {
            padding: 8px;
            margin: 10px 0;
            width: 200px;
        }
        
        .password-button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .password-button:hover {
            background-color: #45a049;
        }
        
        .error-message {
            color: red;
            margin-top: 10px;
        }
        
        .game-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .difficulty-btn {
            padding: 8px 15px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .difficulty-btn:hover {
            background-color: #e1e1e1;
        }
        
        .custom-settings {
            display: none;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .custom-input {
            width: 60px;
            padding: 5px;
            margin: 0 5px;
        }
        
        .game-info {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(var(--cols, 10), 30px);
            grid-template-rows: repeat(var(--rows, 10), 30px);
            gap: 2px;
            margin-bottom: 20px;
        }
        
        .cell {
            width: 30px;
            height: 30px;
            background-color: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            border: 1px solid #bbb;
        }
        
        .cell.revealed {
            background-color: #f5f5f5;
            cursor: default;
        }
        
        .cell.mine {
            background-color: #ff6b6b;
        }
        
        .cell.flagged {
            background-color: #ffcccb;
        }
        
        .number-1 { color: green; }
        .number-2 { color: blue; }
        .number-3 { color: red; }
        .number-4 { color: brown; }
        .number-5 { color: purple; }
        .number-6 { color: yellow; }
        .number-7 { color: orange; }
        .number-8 { color: black; }
        
        .game-over {
            font-size: 24px;
            font-weight: bold;
            color: red;
            margin-bottom: 20px;
        }
        
        .game-win {
            font-size: 24px;
            font-weight: bold;
            color: green;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="password-screen">
        <div class="password-container">
            <h2>Davidçš„æ‰«é›·æ¸¸æˆ</h2>
            <p>è¯·è¾“å…¥å¯†ç è¿›å…¥æ¸¸æˆ</p>
            <input type="password" class="password-input" placeholder="å¯†ç ">
            <button class="password-button">è¿›å…¥æ¸¸æˆ</button>
            <div class="error-message"></div>
        </div>
    </div>
    
    <h1>Davidçš„æ‰«é›·æ¸¸æˆ</h1>
    
    <div class="game-controls">
        <button class="difficulty-btn" data-difficulty="easy">æ™®é€š (10Ã—10, 10é›·)</button>
        <button class="difficulty-btn" data-difficulty="hard">é«˜çº§ (30Ã—30, 75é›·)</button>
        <button class="difficulty-btn" data-difficulty="custom">è‡ªå®šä¹‰</button>
        
        <div class="custom-settings">
            <div>
                <label>è¡Œæ•°: <input type="number" class="custom-input" id="custom-rows" min="1" value="10"></label>
                <label>åˆ—æ•°: <input type="number" class="custom-input" id="custom-cols" min="1" value="10"></label>
                <label>é›·æ•°: <input type="number" class="custom-input" id="custom-mines" min="1" value="10"></label>
            </div>
            <button class="difficulty-btn" id="start-custom" style="margin-top: 10px;">å¼€å§‹æ¸¸æˆ</button>
        </div>
    </div>
    
    <div class="game-info">
        å‰©ä½™é›·æ•°: <span id="mines-left">0</span> | 
        å‰©ä½™ç”Ÿå‘½: <span id="lives-left">0</span>
    </div>
    
    <div class="game-status"></div>
    
    <div class="game-board"></div>
    
    <script>
        // å¯†ç éªŒè¯
        const passwordScreen = document.querySelector('.password-screen');
        const passwordInput = document.querySelector('.password-input');
        const passwordButton = document.querySelector('.password-button');
        const errorMessage = document.querySelector('.error-message');
        const CORRECT_PASSWORD = '123456';
        
        passwordButton.addEventListener('click', () => {
            if (passwordInput.value === CORRECT_PASSWORD) {
                passwordScreen.style.display = 'none';
            } else {
                errorMessage.textContent = 'ä¸æ˜¯å“¥ä»¬ï¼Œä½ é…ç©æ‰«é›·å—ï¼Ÿ';
                setTimeout(() => {
                    window.close();
                }, 1500);
            }
        });
        
        // æ¸¸æˆé€»è¾‘
        let board = [];
        let rows = 10;
        let cols = 10;
        let mineCount = 10;
        let lives = 2;
        let revealedCount = 0;
        let flaggedPositions = new Set();
        let gameOver = false;
        let gameWon = false;
        let firstClick = true;
        
        const gameBoard = document.querySelector('.game-board');
        const minesLeftDisplay = document.getElementById('mines-left');
        const livesLeftDisplay = document.getElementById('lives-left');
        const gameStatusDisplay = document.querySelector('.game-status');
        const customSettings = document.querySelector('.custom-settings');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            board = [];
            revealedCount = 0;
            flaggedPositions = new Set();
            gameOver = false;
            gameWon = false;
            firstClick = true;
            gameStatusDisplay.innerHTML = '';
            
            // è®¾ç½®æ¸¸æˆæ¿æ ·å¼
            gameBoard.style.setProperty('--cols', cols);
            gameBoard.style.setProperty('--rows', rows);
            gameBoard.innerHTML = '';
            
            // æ›´æ–°æ˜¾ç¤º
            minesLeftDisplay.textContent = mineCount;
            livesLeftDisplay.textContent = lives;
            
            // åˆ›å»ºç©ºæ¿
            for (let i = 0; i < rows; i++) {
                board[i] = [];
                for (let j = 0; j < cols; j++) {
                    board[i][j] = {
                        isMine: false,
                        revealed: false,
                        flagged: false,
                        adjacentMines: 0
                    };
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    cell.addEventListener('click', () => handleCellClick(i, j));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(i, j);
                    });
                    
                    gameBoard.appendChild(cell);
                }
            }
        }
        
        // æ”¾ç½®åœ°é›·ï¼ˆé¿å¼€ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®ï¼‰
        function placeMines(safeRow, safeCol) {
            let minesPlaced = 0;
            
            // ç¡®ä¿å®‰å…¨åŒºåŸŸï¼ˆç‚¹å‡»ä½ç½®åŠå…¶å‘¨å›´8æ ¼ï¼‰æ²¡æœ‰åœ°é›·
            const safeArea = [];
            for (let di = -1; di <= 1; di++) {
                for (let dj = -1; dj <= 1; dj++) {
                    const ni = safeRow + di;
                    const nj = safeCol + dj;
                    if (ni >= 0 && ni < rows && nj >= 0 && nj < cols) {
                        safeArea.push(`${ni},${nj}`);
                    }
                }
            }
            
            while (minesPlaced < mineCount) {
                const randomRow = Math.floor(Math.random() * rows);
                const randomCol = Math.floor(Math.random() * cols);
                const positionKey = `${randomRow},${randomCol}`;
                
                // ç¡®ä¿ä¸åœ¨å®‰å…¨åŒºåŸŸæ”¾ç½®åœ°é›·
                if (!board[randomRow][randomCol].isMine && !safeArea.includes(positionKey)) {
                    board[randomRow][randomCol].isMine = true;
                    minesPlaced++;
                }
            }
            
            // è®¡ç®—ç›¸é‚»åœ°é›·æ•°
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (!board[i][j].isMine) {
                        let count = 0;
                        
                        // æ£€æŸ¥æ‰€æœ‰ç›¸é‚»å•å…ƒæ ¼
                        for (let di = -1; di <= 1; di++) {
                            for (let dj = -1; dj <= 1; dj++) {
                                if (di === 0 && dj === 0) continue;
                                
                                const ni = i + di;
                                const nj = j + dj;
                                
                                if (ni >= 0 && ni < rows && nj >= 0 && nj < cols && board[ni][nj].isMine) {
                                    count++;
                                }
                            }
                        }
                        
                        board[i][j].adjacentMines = count;
                    }
                }
            }
        }
        
        // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
        function handleCellClick(row, col) {
            if (gameOver || gameWon || board[row][col].revealed || board[row][col].flagged) {
                return;
            }
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œå…ˆç”Ÿæˆåœ°é›·ï¼ˆé¿å¼€ç‚¹å‡»ä½ç½®ï¼‰
            if (firstClick) {
                firstClick = false;
                placeMines(row, col);
            }
            
            if (board[row][col].isMine) {
                // è¸©åˆ°åœ°é›·
                board[row][col].revealed = true;
                cell.classList.add('revealed', 'mine');
                cell.textContent = 'ğŸ’£';
                
                lives--;
                livesLeftDisplay.textContent = lives;
                
                if (lives <= 0) {
                    gameOver = true;
                    revealAllMines();
                    gameStatusDisplay.innerHTML = '<div class="game-over">æ¸¸æˆç»“æŸï¼ä½ è¾“äº†ï¼</div>';
                }
            } else {
                revealCell(row, col);
                
                // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
                checkWinCondition();
            }
        }
        
        // å¤„ç†å³é”®ç‚¹å‡»ï¼ˆæ’æ——ï¼‰
        function handleRightClick(row, col) {
            if (gameOver || gameWon || board[row][col].revealed) {
                return;
            }
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            const positionKey = `${row},${col}`;
            
            if (board[row][col].flagged) {
                // ç§»é™¤æ——å­
                board[row][col].flagged = false;
                cell.classList.remove('flagged');
                cell.textContent = '';
                flaggedPositions.delete(positionKey);
                minesLeftDisplay.textContent = parseInt(minesLeftDisplay.textContent) + 1;
            } else {
                // æ”¾ç½®æ——å­
                board[row][col].flagged = true;
                cell.classList.add('flagged');
                cell.textContent = 'ğŸš©';
                flaggedPositions.add(positionKey);
                minesLeftDisplay.textContent = parseInt(minesLeftDisplay.textContent) - 1;
                
                // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
                checkWinCondition();
            }
        }
        
        // æ­ç¤ºå•å…ƒæ ¼
        function revealCell(row, col) {
            if (row < 0 || row >= rows || col < 0 || col >= cols || board[row][col].revealed || board[row][col].flagged) {
                return;
            }
            
            board[row][col].revealed = true;
            revealedCount++;
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('revealed');
            
            if (board[row][col].adjacentMines > 0) {
                cell.textContent = board[row][col].adjacentMines;
                cell.classList.add(`number-${board[row][col].adjacentMines}`);
            } else {
                // å¦‚æœæ˜¯ç©ºç™½å•å…ƒæ ¼ï¼Œé€’å½’æ­ç¤ºç›¸é‚»å•å…ƒæ ¼
                for (let di = -1; di <= 1; di++) {
                    for (let dj = -1; dj <= 1; dj++) {
                        if (di === 0 && dj === 0) continue;
                        revealCell(row + di, col + dj);
                    }
                }
            }
        }
        
        // æ­ç¤ºæ‰€æœ‰åœ°é›·
        function revealAllMines() {
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (board[i][j].isMine && !board[i][j].flagged) {
                        const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                        cell.classList.add('revealed', 'mine');
                        cell.textContent = 'ğŸ’£';
                    }
                }
            }
        }
        
        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
        function checkWinCondition() {
            // æ¡ä»¶1: æ‰€æœ‰éåœ°é›·å•å…ƒæ ¼éƒ½è¢«æ­ç¤º
            const nonMineCells = rows * cols - mineCount;
            if (revealedCount === nonMineCells) {
                gameWon = true;
                gameStatusDisplay.innerHTML = '<div class="game-win">æ­å–œï¼ä½ èµ¢äº†ï¼</div>';
                return;
            }
            
            // æ¡ä»¶2: æ‰€æœ‰æ——å­éƒ½æ’åœ¨åœ°é›·ä¸Š
            let allFlagsCorrect = true;
            for (const pos of flaggedPositions) {
                const [row, col] = pos.split(',').map(Number);
                if (!board[row][col].isMine) {
                    allFlagsCorrect = false;
                    break;
                }
            }
            
            if (allFlagsCorrect && flaggedPositions.size === mineCount) {
                gameWon = true;
                gameStatusDisplay.innerHTML = '<div class="game-win">æ­å–œï¼ä½ èµ¢äº†ï¼</div>';
                revealAllMines();
            }
        }
        
        // éš¾åº¦é€‰æ‹©
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const difficulty = this.dataset.difficulty;
                
                if (difficulty === 'easy') {
                    rows = 10;
                    cols = 10;
                    mineCount = 10;
                    lives = 2;
                    customSettings.style.display = 'none';
                    initGame();
                } else if (difficulty === 'hard') {
                    rows = 30;
                    cols = 30;
                    mineCount = 75;
                    lives = 4;
                    customSettings.style.display = 'none';
                    initGame();
                } else if (difficulty === 'custom') {
                    customSettings.style.display = 'block';
                }
            });
        });
        
        // è‡ªå®šä¹‰æ¸¸æˆå¼€å§‹
        document.getElementById('start-custom').addEventListener('click', function() {
            const customRows = parseInt(document.getElementById('custom-rows').value);
            const customCols = parseInt(document.getElementById('custom-cols').value);
            const customMines = parseInt(document.getElementById('custom-mines').value);
            
            if (customRows <= 0 || customCols <= 0 || customMines <= 0) {
                alert('è¡Œæ•°ã€åˆ—æ•°å’Œé›·æ•°å¿…é¡»å¤§äº0');
                return;
            }
            
            if (customMines >= customRows * customCols) {
                alert('é›·æ•°ä¸èƒ½è¶…è¿‡æ€»æ ¼å­æ•°');
                return;
            }
            
            rows = customRows;
            cols = customCols;
            mineCount = customMines;
            lives = Math.min(10, Math.floor(mineCount / 2)); // ç”Ÿå‘½æ•°ä¸è¶…è¿‡é›·æ•°çš„ä¸€åŠï¼Œæœ€å¤š10æ¡å‘½
            
            initGame();
            customSettings.style.display = 'none';
        });
        
        // åˆå§‹åŒ–ä¸ºæ™®é€šéš¾åº¦
        initGame();
    </script>
</body>
</html>